<!DOCTYPE html>
<html lang="en">
	<head>
		<base href="%BASE%" />
		
		<!--SECURITY-->
		
		<title>gbajs3</title>

		<!--MGBAJS-->
		
	</head>
	<body>
		<!-- gba canvas "screen" -->
		<div id="screenwrapper">
			<canvas id="screen" width="480" height="320"></canvas>
		</div>

		<!-- main driving javascript -->
		<script  defer>
			const mgba = new mGBA();
			mgba.setCanvas(document.getElementById('screen'));
			mgba.setBios('%BIOS%');
			mgba.setRom('%ROM%');
			mgba.start();
		</script>
		<script>
			// Work-around chromium autoplay policy
			// https://github.com/emscripten-core/emscripten/issues/6511
			function resumeAudio(e) {
				const audioPolyfillCallback = () => {
					document
						.getElementById('screen')
						.removeEventListener('click', resumeAudio);
					document.removeEventListener('keydown', resumeAudio);
				};
				emulator.AudioPolyfill(audioPolyfillCallback);
			}
			document
				.getElementById('screen')
				.addEventListener('click', resumeAudio);
			document.addEventListener('keydown', resumeAudio);
		</script>

		<script>
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker
					.register('/service-worker.js', {
						scope: '/'
					})
					.then(function () {
						console.log('Service Worker Registered');
					});
			}
		</script>
	</body>
</html>
